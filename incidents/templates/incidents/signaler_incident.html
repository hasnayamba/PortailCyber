{% extends 'incidents/base.html' %}

{% block title %}Signaler un incident{% endblock %}

{% block content %}

    <h2>üö® Signaler un incident</h2>

    {% if messages %}
    <div class="mb-3">
        {% for message in messages %}
            <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                {{ message }}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Fermer"></button>
            </div>
        {% endfor %}
    </div>
    {% endif %}

    <form method="post" enctype="multipart/form-data" action="{% url 'signaler_incident' %}">
        {% csrf_token %}

        <div class="mb-4">
            <label for="type_incident" class="form-label">Type d‚Äôincident *</label>
            <select id="type_incident" name="type_incident" class="form-select" required>
                <option value="" disabled selected>-- Choisir --</option>
                <option value="phishing">Phishing</option>
                <option value="malware">Malware</option>
                <option value="cyberharcelement">Cyberharc√®lement</option>
                <option value="deepfake">Deepfake</option>
                <option value="desinformation">D√©sinformation</option>
                <option value="autre">Autre</option>
            </select>
        </div>

        <div class="mb-4">
            <label for="description" class="form-label">Description *</label>
            <textarea id="description" name="description" class="form-control" rows="5" placeholder="D√©cris pr√©cis√©ment l'incident..." required></textarea>
        </div>

        <div class="mb-4">
            <label for="geolocalisation" class="form-label">G√©olocalisation (facultatif)</label>
            <div class="input-group">
                <input type="text" id="geolocalisation" name="geolocalisation" class="form-control" placeholder="Cliquez pour d√©tecter la position" readonly />
                <button type="button" class="btn btn-outline-primary" onclick="getLocation()">üìç</button>
            </div>
            <small class="text-muted">Nous utiliserons votre position actuelle</small>
        </div>

        <div class="mb-4">
            <label class="form-label">Preuves (optionnel)</label>
            <div class="row g-3">
                <div class="col-md-4">
                    <input type="file" id="preuve_image" name="preuve_image" accept="image/*" class="form-control" />
                    <small class="text-muted">JPEG, PNG</small>
                </div>
                <div class="col-md-4">
                    <input type="file" id="preuve_video" name="preuve_video" accept="video/*" class="form-control" />
                    <small class="text-muted">MP4, MOV</small>
                </div>
                <div class="col-md-4">
                    <input type="file" id="preuve_log" name="preuve_log" accept=".txt,.log" class="form-control" />
                    <small class="text-muted">Fichier texte</small>
                </div>
            </div>
        </div>

        <button type="submit" class="btn btn-primary">üì§ Envoyer le signalement</button>
    </form>
</div>

<script>
function getLocation() {
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(showPosition, showError);
    } else {
        alert("La g√©olocalisation n'est pas support√©e par ce navigateur.");
    }
}

function showPosition(position) {
    const latitude = position.coords.latitude;
    const longitude = position.coords.longitude;
    document.getElementById("geolocalisation").value = latitude + ", " + longitude;
}

function showError(error) {
    switch(error.code) {
        case error.PERMISSION_DENIED:
            alert("Vous avez refus√© la demande de g√©olocalisation.");
            break;
        case error.POSITION_UNAVAILABLE:
            alert("Les informations de localisation sont indisponibles.");
            break;
        case error.TIMEOUT:
            alert("La demande de localisation a expir√©.");
            break;
        default:
            alert("Une erreur inconnue est survenue.");
            break;
    }
}
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
{% endblock %}
